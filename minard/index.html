<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<style type="text/css">
html, body {
    width: 100%;
    height: 100%;
}
body {
    font-family: sans-serif;
    font-size: 0.8em;
}
#mapEl {
    position: relative;
    width: 100%;
    height: 300px;
}
svg.mapmap .geometry path {
}
</style>
</head>
<body>

<svg id="mapEl" width="800" height="400"></svg>
<small>Map data taken from <a href="http://benschmidt.org/D3-trail/minard.html">Ben Schmidt</a></small>

<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="http://d3js.org/d3.v3.js"></script>
<script src="data.js"></script>
<script src="../lib/mapmap.js"></script>
<script>
var map = mapmap('mapEl')
	.geometry(napoleon.cities, geoPoint('lat','lon'))
	.hoverInfo('name')
	.geometry(napoleon.army, dd.map.key('group'), geoPairs)
	.hoverInfo('size')
    .symbolize(lineWidth)
    //.applyBehaviour(mapmap.interactions.zoom())
;

function lineWidth(el, geom) {
    if (geom.properties.size) {
        el.attr({
            'stroke-width': geom.properties.size / 10000,
            'stroke-linecap': 'round'
        });
    }
    var colors = ['#000000','#ff0000','#00ff00'];
    if (geom.properties.group) {
        el.attr('stroke', colors[geom.properties.group - 1]);
    }
}

function geoPoint(latProp, lonProp, keyProp) {
    var id = 0;
    return function(d, emit) {
        var key = keyProp ? d[keyProp] : id++;
        emit(key, {
            type: 'Feature',
            geometry: {
                type: 'Point',
                coordinates: [d[lonProp], d[latProp]]
            },
            properties: d
        })
    }
}

function geoLine(coordinates, properties) {
    return {
        type: 'Feature',
        geometry: {
            type: 'LineString',
            coordinates: coordinates
        },
        properties: properties
    }
}

function geoPairs(key, data, emit) {
    var prev = null, cur = null;
    for (var i=0; i<data.length; i++) {
        cur = data[i];
        if (prev) {
            emit(key + '-' + i, geoLine([[prev.lon,prev.lat],[cur.lon,cur.lat]], prev));
        }
        prev = cur;
    }
}
</script>
</body>
